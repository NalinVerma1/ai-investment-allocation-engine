# AI Investment Allocation Engine

This project is an Investment Decision Support System (DSS) built using Python and Google Sheets. It is designed to bridge quantitative portfolio logic with AI-generated natural language explanations.

The system retrieves live market data, applies user-defined portfolio constraints, identifies an optimal asset allocation using robust scoring logic, and writes the final results and an AI-driven summary back to Google Sheets.

This project was developed as an end-to-end finance and Python system, emphasizing system design, transparency, and data automation.

## Key Features

* **Live Data Integration:** Automated ETF price and return retrieval via GOOGLEFINANCE.
* **Constraint-Based Optimization:** Enforces diversification through minimum/maximum weight limits and risk thresholds.
* **Robust Scoring Logic:** Utilizes worst-case (bear market) return analysis to select optimal weights.
* **No-Code UI:** Utilizes Google Sheets as the primary interface for data input and reporting.
* **AI Explainability:** Integrates Google Gemini to explain the logic behind specific allocations.

## Tech Stack
* **Language:** Python
* **Interface:** Google Sheets (via gspread API)
* **AI Model:** Google Gemini (LLM)
* **Libraries:** gspread, pandas, google-generativeai

## Getting Started (High-Level)
1. Clone the repository
2. Set up Google Sheets + service account credentials
3. Configure `.env` variables
4. Run `python src/main.py`

Detailed setup intentionally omitted to keep focus on system design.


## Google Sheets Interface
The system uses the following sheet structure for inputs and outputs:

### Assets Tab
Tracks 10 diversified asset classes with live market data.
* **Columns:** Asset, Ticker, RiskScore, Price (USD), Return_1Y, Return_5Y.
* **Logic:** Returns are calculated using live market prices via `GOOGLEFINANCE`.
* **Risk Management:** `RiskScore` serves as an ordinal proxy for relative volatility by asset class.

### Constraints Tab
Allows the user to set global and asset-specific boundaries for the engine.
* **Global:** Total Capital (e.g., 100,000) and MaxRisk score (e.g., 3).
* **Asset-Level:** `MinWeight` and `MaxWeight` percentages (e.g., US Equity required between 25% and 30%).

### Results & AI_Explanation Tabs
* **Results:** Destination for calculated optimal weights and dollar-value allocations.
* **AI_Explanation:** A narrative justification generated by the LLM explaining why the specific portfolio was chosen.

### Scenarios Tab
* This tab is reserved for **future implementations**, intended to allow for custom bull/bear scenario testing and manual stress testing adjustments.

## Project Structure

```text
src/
├── main.py               # Application entry point
├── sheets.py             # Google Sheets API I/O operations
├── assets_io.py          # Asset data ingestion
├── constraints_io.py     # Constraint data ingestion
├── scenario_builder.py   # Historical return scenario generation
├── engine.py             # Optimization engine
├── generator.py          # Portfolio weight generation logic
├── scoring.py            # Worst-case return scoring algorithms
├── portfolio.py          # Selection logic for best-performing portfolios
└── ai_explanation.py     # LLM prompt engineering and generation

```md

## System Workflow

* **Data Ingestion:** Read market data and user constraints from Google Sheets.
* **Scenario Construction:** Build Bull, Base, and Bear scenarios based on historical performance.
* **Feasibility Analysis:** Filter all potential portfolios against weight and risk constraints.
* **Optimization:** Apply scoring logic to identify the portfolio with the highest worst-case return.
* **Output Generation:** Write numerical allocations and dollar values to the Results tab.
* **Interpretive Layer:** Trigger the LLM to analyze the results and write a summary to the AI_Explanation tab.

## Methodology and Data Assumptions

### Price Return vs. Total Return
Performance metrics utilize the `GOOGLEFINANCE` "price" attribute, representing Price Return only.

* **Equity ETFs (SPY, QQQ):** Returns do not include reinvested dividends. Historical performance is approximately 1.5%–2% higher annually when accounting for total return.
* **Fixed Income (AGG):** The 5-year price return reflects the capital decline during 2022–2023. While price returns appear significantly negative, Total Return (including coupons) was closer to break-even.
* **Commodities (GLD):** As a non-yielding asset, price return is equivalent to total return.

### Technical Constraints
The system uses an automated pipeline that prioritizes reproducibility and accessibility. To maintain a fully automated flow without requiring paid third-party financial APIs, dividend yields and interest payments are excluded.

### Design Note: Scenarios Tab
A dedicated Scenarios tab is included in the architecture as a planned extension. Currently, the system generates scenarios automatically from historical data to minimize user bias and maintain automation. Future iterations will allow for custom stress testing and macro-driven manual overrides via this tab.

---

### Disclaimer
This project is for educational purposes only and does not constitute financial or investment advice.

---

### Author
**Nalin Verma**
Management Engineering, University of Waterloo
*Focus: Quantitative Finance, AI Systems, Product Design*